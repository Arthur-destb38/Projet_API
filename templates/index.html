<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Sentiment Analyzer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        header { background: #1a1a2e; color: white; padding: 30px 0; margin-bottom: 30px; }
        header h1 { text-align: center; font-size: 2rem; margin-bottom: 10px; }
        header p { text-align: center; color: #888; }
        
        .prices { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .price-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .price-card h3 { font-size: 1rem; color: #666; margin-bottom: 5px; }
        .price-card .value { font-size: 1.5rem; font-weight: bold; }
        .price-card .change { font-size: 0.9rem; }
        .change.positive { color: #28a745; }
        .change.negative { color: #dc3545; }
        
        .methods { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .method-card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .method-card h2 { font-size: 1.3rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #eee; }
        .method-card.selenium h2 { border-color: #007bff; }
        .method-card.http h2 { border-color: #28a745; }
        
        .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; margin-left: 10px; }
        .badge.cours { background: #007bff; color: white; }
        .badge.bonus { background: #28a745; color: white; }
        
        .method-card p { color: #666; margin-bottom: 15px; line-height: 1.6; }
        .method-card ul { margin-left: 20px; color: #666; margin-bottom: 20px; }
        .method-card li { margin-bottom: 8px; }
        
        form { margin-top: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; }
        select, input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px; font-size: 1rem; }
        button { width: 100%; padding: 12px; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; font-weight: 500; }
        button.selenium { background: #007bff; color: white; }
        button.http { background: #28a745; color: white; }
        button:hover { opacity: 0.9; }
        
        .results { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 30px; display: none; }
        .results h2 { margin-bottom: 20px; }
        .results-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .result-item { background: #f8f9fa; padding: 15px; border-radius: 4px; text-align: center; }
        .result-item .label { font-size: 0.85rem; color: #666; }
        .result-item .value { font-size: 1.3rem; font-weight: bold; margin-top: 5px; }
        
        .posts-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .posts-table th, .posts-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .posts-table th { background: #f8f9fa; font-weight: 500; }
        .posts-table tr:hover { background: #f8f9fa; }
        
        .sentiment-positive { color: #28a745; }
        .sentiment-negative { color: #dc3545; }
        .sentiment-neutral { color: #6c757d; }
        
        .loading { text-align: center; padding: 40px; color: #666; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        footer { text-align: center; padding: 30px; color: #888; margin-top: 30px; }
        
        @media (max-width: 768px) {
            .methods { grid-template-columns: 1fr; }
            .results-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Crypto Sentiment Analyzer</h1>
            <p>Projet MoSEF 2024-2025 - Webscraping & NLP</p>
        </div>
    </header>
    
    <div class="container">
        <!-- Prix -->
        <div class="prices">
            {% for name, data in prices.items() %}
            <div class="price-card">
                <h3>{{ name | capitalize }}</h3>
                <div class="value">${{ "{:,.0f}".format(data.price) }}</div>
                <div class="change {% if data.change_24h > 0 %}positive{% else %}negative{% endif %}">
                    {{ "{:+.2f}".format(data.change_24h) }}% (24h)
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Deux methodes -->
        <div class="methods">
            <!-- Selenium -->
            <div class="method-card selenium">
                <h2>Methode Selenium <span class="badge cours">COURS</span></h2>
                <p>Webscraping avec simulation de comportement humain. C'est la methode demandee par le cours.</p>
                <ul>
                    <li>Ouvre un vrai navigateur Chrome</li>
                    <li>Simule les scrolls et les clics</li>
                    <li>Delais aleatoires entre actions</li>
                    <li>Parse le HTML avec BeautifulSoup</li>
                </ul>
                
                <form id="form-selenium">
                    <label>Subreddit</label>
                    <select name="subreddit">
                        <option value="Bitcoin">r/Bitcoin</option>
                        <option value="ethereum">r/ethereum</option>
                        <option value="CryptoCurrency">r/CryptoCurrency</option>
                        <option value="solana">r/solana</option>
                        <option value="dogecoin">r/dogecoin</option>
                    </select>
                    
                    <label>Nombre de posts</label>
                    <input type="number" name="limit" value="30" min="10" max="100">
                    
                    <button type="submit" class="selenium">Analyser (Selenium)</button>
                </form>
            </div>
            
            <!-- HTTP -->
            <div class="method-card http">
                <h2>Methode HTTP/JSON <span class="badge bonus">BONUS</span></h2>
                <p>Appel direct a l'API JSON de Reddit. Plus rapide mais ce n'est pas du webscraping.</p>
                <ul>
                    <li>Simple requete HTTP</li>
                    <li>Reponse JSON structuree</li>
                    <li>Pas besoin de parser le HTML</li>
                    <li>Beaucoup plus rapide</li>
                </ul>
                
                <form id="form-http">
                    <label>Subreddit</label>
                    <select name="subreddit">
                        <option value="Bitcoin">r/Bitcoin</option>
                        <option value="ethereum">r/ethereum</option>
                        <option value="CryptoCurrency">r/CryptoCurrency</option>
                        <option value="solana">r/solana</option>
                        <option value="dogecoin">r/dogecoin</option>
                    </select>
                    
                    <label>Nombre de posts</label>
                    <input type="number" name="limit" value="30" min="10" max="100">
                    
                    <button type="submit" class="http">Analyser (HTTP)</button>
                </form>
            </div>
        </div>
        
        <!-- Resultats -->
        <div class="results" id="results">
            <h2>Resultats</h2>
            
            <div class="results-grid">
                <div class="result-item">
                    <div class="label">Methode</div>
                    <div class="value" id="res-method">-</div>
                </div>
                <div class="result-item">
                    <div class="label">Temps</div>
                    <div class="value" id="res-time">-</div>
                </div>
                <div class="result-item">
                    <div class="label">Posts</div>
                    <div class="value" id="res-posts">-</div>
                </div>
                <div class="result-item">
                    <div class="label">Sentiment moyen</div>
                    <div class="value" id="res-sentiment">-</div>
                </div>
            </div>
            
            <div class="results-grid">
                <div class="result-item">
                    <div class="label">Positifs</div>
                    <div class="value sentiment-positive" id="res-positive">-</div>
                </div>
                <div class="result-item">
                    <div class="label">Negatifs</div>
                    <div class="value sentiment-negative" id="res-negative">-</div>
                </div>
                <div class="result-item">
                    <div class="label">Neutres</div>
                    <div class="value sentiment-neutral" id="res-neutral">-</div>
                </div>
                <div class="result-item">
                    <div class="label">Prix actuel</div>
                    <div class="value" id="res-price">-</div>
                </div>
            </div>
            
            <h3 style="margin-top: 25px; margin-bottom: 15px;">Posts analyses</h3>
            <table class="posts-table">
                <thead>
                    <tr>
                        <th>Titre</th>
                        <th>Score</th>
                        <th>Label</th>
                    </tr>
                </thead>
                <tbody id="posts-body">
                </tbody>
            </table>
        </div>
        
        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Analyse en cours...</p>
        </div>
    </div>
    
    <footer>
        <p>Projet Webscraping & NLP - Master 2 MoSEF Data Science - Paris 1 Pantheon-Sorbonne</p>
    </footer>
    
    <script>
        async function analyze(method, subreddit, limit) {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            
            const crypto = subreddit.toLowerCase() === 'bitcoin' ? 'bitcoin' : 
                          subreddit.toLowerCase() === 'ethereum' ? 'ethereum' : 'bitcoin';
            
            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        crypto: crypto,
                        subreddit: subreddit,
                        limit: parseInt(limit),
                        method: method
                    })
                });
                
                const data = await response.json();
                
                document.getElementById('res-method').textContent = data.method;
                document.getElementById('res-time').textContent = data.total_time + 's';
                document.getElementById('res-posts').textContent = data.posts_analyzed;
                document.getElementById('res-sentiment').textContent = data.sentiment.average.toFixed(3);
                document.getElementById('res-positive').textContent = data.sentiment.distribution.positive;
                document.getElementById('res-negative').textContent = data.sentiment.distribution.negative;
                document.getElementById('res-neutral').textContent = data.sentiment.distribution.neutral;
                
                if (data.price) {
                    document.getElementById('res-price').textContent = '$' + data.price.price.toLocaleString();
                }
                
                const tbody = document.getElementById('posts-body');
                tbody.innerHTML = '';
                data.posts.slice(0, 20).forEach(post => {
                    const row = document.createElement('tr');
                    const labelClass = 'sentiment-' + post.label;
                    row.innerHTML = `
                        <td>${post.title.substring(0, 70)}...</td>
                        <td>${post.score.toFixed(3)}</td>
                        <td class="${labelClass}">${post.label}</td>
                    `;
                    tbody.appendChild(row);
                });
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'block';
                
            } catch (error) {
                alert('Erreur: ' + error.message);
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        document.getElementById('form-selenium').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            analyze('selenium', formData.get('subreddit'), formData.get('limit'));
        });
        
        document.getElementById('form-http').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            analyze('http', formData.get('subreddit'), formData.get('limit'));
        });
    </script>
</body>
</html>
