<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Crypto Sentiment API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f9f9f9;
        }

        h1 {
            color: #333;
        }

        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }

        select, input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        button.secondary {
            background: #28a745;
        }

        .results {
            background: #f0f0f0;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 13px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f5f5f5;
        }

        .crypto-list {
            background: #fffde7;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 15px;
        }

        .method-info {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .positive {
            color: green;
        }

        .negative {
            color: red;
        }

        .neutral {
            color: gray;
        }

        #loading {
            display: none;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
<h1>Crypto Sentiment API</h1>
<p>Projet MoSEF 2024-2025 - Webscraping et NLP</p>

<div class="section">
    <h2>Cryptos disponibles</h2>
    <div class="crypto-list">
        <strong>Singles:</strong> bitcoin, ethereum, solana, cardano, dogecoin, ripple, polkadot, chainlink, litecoin,
        avalanche, polygon, cosmos, uniswap, near, aptos, arbitrum, optimism<br>
        <strong>Memecoins:</strong> shiba-inu, pepe, floki, bonk
    </div>

    <h2>Methodes de scraping</h2>
    <div class="method-info">
        <strong>Selenium (cours):</strong> Ouvre un navigateur, simule un humain, parse le HTML. Plus lent mais c'est ce
        que le prof demande.<br>
        <strong>HTTP/JSON (bonus):</strong> Appel direct API Reddit. Rapide mais pas du "vrai" webscraping.
    </div>
</div>

<div class="section">
    <h2>Analyse simple</h2>

    <label>Methode</label>
    <select id="method">
        <option value="selenium">Selenium (cours)</option>
        <option value="http">HTTP/JSON (bonus)</option>
    </select>

    <label>Crypto</label>
    <select id="crypto">
        <option value="bitcoin">Bitcoin (BTC)</option>
        <option value="ethereum">Ethereum (ETH)</option>
        <option value="solana">Solana (SOL)</option>
        <option value="cardano">Cardano (ADA)</option>
        <option value="dogecoin">Dogecoin (DOGE)</option>
        <option value="ripple">Ripple (XRP)</option>
        <option value="polkadot">Polkadot (DOT)</option>
        <option value="chainlink">Chainlink (LINK)</option>
        <option value="litecoin">Litecoin (LTC)</option>
        <option value="shiba-inu">Shiba Inu (SHIB)</option>
        <option value="pepe">Pepe (PEPE)</option>
    </select>

    <label>Nombre de posts (max 500)</label>
    <input type="number" id="limit" value="50" min="10" max="500">

    <button onclick="analyze()">Lancer l'analyse</button>
    <span id="loading">Chargement en cours...</span>
</div>

<div class="section">
    <h2>Analyse multi-crypto</h2>
    <p>Scrape plusieurs cryptos en une fois</p>

    <label>Cryptos (separees par des virgules)</label>
    <input type="text" id="multi-cryptos" value="bitcoin,ethereum,solana" placeholder="bitcoin,ethereum,solana">

    <label>Posts par crypto</label>
    <input type="number" id="multi-limit" value="30" min="10" max="200">

    <button class="secondary" onclick="analyzeMulti()">Analyser tout</button>
</div>

<div class="section">
    <h2>Resultats</h2>
    <div id="results" class="results">Les resultats s'afficheront ici...</div>
</div>

<script>
    const API = '';

    async function analyze() {
        const method = document.getElementById('method').value;
        const crypto = document.getElementById('crypto').value;
        const limit = document.getElementById('limit').value;

        document.getElementById('loading').style.display = 'inline';
        document.getElementById('results').innerHTML = 'Scraping en cours...';

        try {
            const resp = await fetch(`${API}/analyze`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    crypto: crypto,
                    subreddit: crypto.charAt(0).toUpperCase() + crypto.slice(1),
                    limit: parseInt(limit),
                    method: method
                })
            });

            const data = await resp.json();

            let html = `METHODE: ${data.method}\n`;
            html += `CRYPTO: ${data.crypto}\n`;
            html += `POSTS: ${data.posts_analyzed}\n`;
            html += `TEMPS: ${data.total_time}s\n\n`;
            html += `SENTIMENT MOYEN: ${data.sentiment.average.toFixed(4)}\n`;
            html += `Positifs: ${data.sentiment.distribution.positive}\n`;
            html += `Negatifs: ${data.sentiment.distribution.negative}\n`;
            html += `Neutres: ${data.sentiment.distribution.neutral}\n\n`;

            if (data.price) {
                html += `PRIX: $${data.price.price.toLocaleString()} (${data.price.change_24h}%)\n\n`;
            }

            html += `--- TOP POSTS ---\n`;
            data.posts.slice(0, 10).forEach((p, i) => {
                const cls = p.label === 'positive' ? 'positive' : p.label === 'negative' ? 'negative' : 'neutral';
                html += `${i+1}. [${p.score.toFixed(3)}] ${p.title.substring(0, 60)}...\n`;
            });

            document.getElementById('results').innerHTML = html;
        } catch (e) {
            document.getElementById('results').innerHTML = 'Erreur: ' + e.message;
        }

        document.getElementById('loading').style.display = 'none';
    }

    async function analyzeMulti() {
        const cryptos = document.getElementById('multi-cryptos').value.split(',').map(c => c.trim());
        const limit = document.getElementById('multi-limit').value;

        document.getElementById('results').innerHTML = 'Analyse multi-crypto en cours...\n';

        for (const crypto of cryptos) {
            document.getElementById('results').innerHTML += `\nScraping ${crypto}...\n`;

            try {
                const resp = await fetch(`${API}/analyze`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        crypto: crypto,
                        subreddit: crypto.charAt(0).toUpperCase() + crypto.slice(1),
                        limit: parseInt(limit),
                        method: 'http'
                    })
                });

                const data = await resp.json();

                let html = document.getElementById('results').innerHTML;
                html += `${crypto.toUpperCase()}: ${data.posts_analyzed} posts, sentiment=${data.sentiment.average.toFixed(3)}\n`;
                document.getElementById('results').innerHTML = html;

            } catch (e) {
                document.getElementById('results').innerHTML += `${crypto}: ERREUR\n`;
            }
        }

        document.getElementById('results').innerHTML += '\nTermine!';
    }
</script>
</body>
</html>